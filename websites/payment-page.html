<!DOCTYPE html>
<head>
    <title>Payment</title>
</head>
<body>
    You are logged in as <span id="username" style="font-weight: bold;">username</span>
    <button id="logout-button">Log Out</button>
    <br>
    <h1>Payments</h1><br>
    Send to User<br>
    Username: <input><br>
    Amount: <input><br>
    <button>Send</button><br><br>
    Request from User<br>
    Username: <input><br>
    Amount: <input><br>
    <button>Request</button>
</body>
<script src="/client-functions.js"></script>

<script> 
    async function setUserName() {
        var usernameElement = document.getElementById("username")
        var sessionId = getCookie("sessionId")
        //wait()

        let returned = await makeServerRequest("get-user-info",{sessionId : sessionId})
        console.log(returned)
    }

    const logoutButton = document.getElementById("logout-button");

    document.getElementbyID("logout-button").addEventListener("click", async function() {
            console.log("Logging Out");
            //app.get("/login", function(req,res)
            window.location.href = "/log-out"
        });

    setUserName()

    async function sendMoney(userId, targetId, amount) {
        if (!sender) {
            console.log("sender does not exist")
            return;
        }

        if (!targetId) { // If not target Id (or if wrong)
            return;
        }

        if  (sender.balance < amount) {
            console.log("not enough money")
            return;
        }

        //Can try to use a try-catch, dont want to risk it
        datastores/userData.db
        await fetch(`/api/users/${senderId}/updateBalance`, {
            method : 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({amount: -money}),

        });
        await fetch(`/api/users/${recevierId}/updateBalance`, {
            method : 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({amount: money}),

        });
        console.log(`Successfully sent $${money} from ${senderId} to ${receiverId}.`);
    }
     
</script>

